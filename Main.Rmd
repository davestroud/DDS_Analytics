---
title: "DDS_Analytics"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(keras)
library(lime)
library(tidyquant)
library(rsample)
library(recipes)
library(yardstick)
library(corrr)
library(readxl)
library(tidyverse)
library(glmnet)
library(rpart)
library(rpart.plot)
library(randomForest)
```


```{r}
DDSA <- read_excel("CaseStudy2-data.xlsx")

# Convert data to tbl class to make data easier to manage
DDSA <- tbl_df(DDSA)

# Convert attrition to a factor to logistic regression
#DDSA$Attrition = as.factor(DDSA$Attrition)
```

```{r}
# View observations and variables
glimpse(DDSA)
```

```{r}
# View summary statistics
summary(DDSA)
```


```{r}
# Changed the following variables to categorical to eventually have a LifeSatisfaction variable
DDSA$DistanceFromHome <- cut(DDSA$DistanceFromHome, breaks = c(-Inf, 9, 21, Inf), labels=c("Poor", "Fair", "Good"))

DDSA$RelationshipSatisfaction <- cut(DDSA$RelationshipSatisfaction, breaks = c(-Inf, 2, 3, Inf), labels=c("Poor", "Fair", "Good"))

DDSA$WorkLifeBalance <- cut(DDSA$WorkLifeBalance, breaks = c(-Inf, 2, 3, Inf), labels=c("Poor", "Fair", "Good"))

```


```{r}
ggplot(data = DDSA) +
  geom_bar(mapping = aes(x=DistanceFromHome))
```


```{r}
ggplot(data = DDSA) +
  geom_bar(mapping = aes(x=RelationshipSatisfaction))
```

```{r}
ggplot(data = DDSA) +
  geom_bar(mapping = aes(x=WorkLifeBalance))
```



```{r}
# Is there a relationship between Age and Income. 
# Color each point based on the Gender of the participant
ggplot(data=DDSA) +
  geom_point(mapping = aes(x = Age, y = MonthlyIncome, color=Gender)) +
  geom_smooth(mapping = aes(x = Age, y = MonthlyIncome))
```


```{r}
# Split test/training sets ~ uses the rsample package
set.seed(100)
train_test_split <- initial_split(DDSA, prop = 0.8)
train_test_split
```

```{r}
# Retrieve train and test sets
train_tbl <- training(train_test_split)
test_tbl <- testing(train_test_split)
```

```{r}
table(test_tbl$Attrition)
```


```{r}
237/nrow(test_tbl)
```

```{r}
modelCart = rpart(Attrition ~ ., data=train_tbl, method="class")
#Plot the model
prp(modelCart)
```

```{r}
#Predict the test data
predictionCart <- predict(modelCart, newdata=test_tbl, type="class")

#CART Accuracy
#Confusion matrix 
t1 <- table(test_tbl$Attrition, predictionCart)


#CART model accuracy
(t1[1]+t1[4])/(nrow(test_tbl))
```





